<!DOCTYPE html>
<html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Nokogiri::XML::Schema
  
    — Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css">

  <link rel="stylesheet" href="../../css/common.css" type="text/css">

<script type="text/javascript">
  pathId = "Nokogiri::XML::Schema";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


      <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1260604-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-1260604-8');
    </script>
</head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> »
    <span class="title"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span> » <span class="title"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span>
     » 
    <span class="title">Schema</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link" href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content">
<h1 id="Class%3A+Nokogiri%3A%3AXML%3A%3ASchema">Class: Nokogiri::XML::Schema
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Nokogiri::XML::Schema</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/nokogiri/xml/schema.rb<span class="defines">,<br>
  ext/nokogiri/xml_schema.c</span>
</dd>
  </dl>
  
</div>

<h2 id="Overview">Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>Nokogiri::XML::Schema is used for validating XML against a schema (usually from an xsd file).</p>

<h2 id="label-Synopsis">Synopsis</h2>

<p>Validate an XML document against a Schema.  Loop over the errors that are returned and print them out:</p>

<pre class="code ruby"><code class="ruby"><span class="id identifier rubyid_xsd">xsd</span> <span class="op">=</span> <span class="const"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span><span class="op">::</span><span class="const">Schema</span><span class="lparen">(</span><span class="const">File</span><span class="period">.</span><span class="id identifier rubyid_read">read</span><span class="lparen">(</span><span class="const">PO_SCHEMA_FILE</span><span class="rparen">)</span><span class="rparen">)</span>
<span class="id identifier rubyid_doc">doc</span> <span class="op">=</span> <span class="const"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span><span class="lparen">(</span><span class="const">File</span><span class="period">.</span><span class="id identifier rubyid_read">read</span><span class="lparen">(</span><span class="const">PO_XML_FILE</span><span class="rparen">)</span><span class="rparen">)</span>

<span class="id identifier rubyid_xsd">xsd</span><span class="period">.</span><span class="id identifier rubyid_validate">validate</span><span class="lparen">(</span><span class="id identifier rubyid_doc">doc</span><span class="rparen">)</span><span class="period">.</span><span class="id identifier rubyid_each">each</span> <span class="kw">do</span> <span class="op">|</span><span class="id identifier rubyid_error">error</span><span class="op">|</span>
  <span class="id identifier rubyid_puts">puts</span> <span class="id identifier rubyid_error">error</span><span class="period">.</span><span class="id identifier rubyid_message">message</span>
<span class="kw">end</span>
</code></pre>

<p>The list of errors are Nokogiri::XML::SyntaxError objects.</p>

<p>NOTE: As of v1.11.0, Schema treats inputs as UNTRUSTED by default, and so external entities are not resolved from the network (`http://` or `ftp://`). Previously, parsing treated documents as “trusted” by default which was counter to Nokogiri's “untrusted by default” security policy. If a document is trusted, then the caller may turn off the NONET option via the ParseOptions to re-enable external entity resolution over a network connection.</p>


  </div>
</div>
<div class="tags">
  

</div>
<div id="subclasses">
  <h2 id="Direct+Known+Subclasses">Direct Known Subclasses</h2>
  <p class="children"><span class="object_link"><a href="RelaxNG.html" title="Nokogiri::XML::RelaxNG (class)">RelaxNG</a></span></p>
</div>




  <h2 id="Instance+Attribute+Summary">Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small>
</h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#errors-instance_method" title="#errors (instance method)">#<strong>errors</strong>  ⇒ Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Errors while parsing the schema file.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_options-instance_method" title="#parse_options (instance method)">#<strong>parse_options</strong>  ⇒ Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>The Nokogiri::XML::ParseOptions used to parse the schema.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2 id="Class+Method+Summary">
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#from_document-class_method" title="from_document (class method)">.<strong>from_document</strong>(doc)  ⇒ Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Create a new Schema from the Nokogiri::XML::Document <code>doc</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(string_or_io, options = ParseOptions::DEFAULT_SCHEMA)  ⇒ Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Create a new Nokogiri::XML::Schema object using a <code>string_or_io</code> object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_memory-class_method" title="read_memory (class method)">.<strong>read_memory</strong>(string)  ⇒ Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Create a new Schema from the contents of <code>string</code>.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2 id="Instance+Method+Summary">
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#valid%3F-instance_method" title="#valid? (instance method)">#<strong>valid?</strong>(thing)  ⇒ Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Returns true if <code>thing</code> is a valid Nokogiri::XML::Document or file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate-instance_method" title="#validate (instance method)">#<strong>validate</strong>(thing)  ⇒ Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Validate <code>thing</code> against this schema.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2 id="Instance+Attribute+Details">Instance Attribute Details</h2>
    
      
      <span id="errors=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="errors-instance_method">
  
    #<strong>errors</strong>  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Errors while parsing the schema file</p>


  </div>
</div>
<div class="tags">
  

</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nokogiri/xml/schema.rb', line 38</span>

<span class="kw">def</span> <span class="id identifier rubyid_errors">errors</span>
  <span class="ivar">@errors</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="parse_options=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="parse_options-instance_method">
  
    #<strong>parse_options</strong>  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>The Nokogiri::XML::ParseOptions used to parse the schema</p>


  </div>
</div>
<div class="tags">
  

</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nokogiri/xml/schema.rb', line 40</span>

<span class="kw">def</span> <span class="id identifier rubyid_parse_options">parse_options</span>
  <span class="ivar">@parse_options</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2 id="Class+Method+Details">Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="from_document-class_method">
  
    .<strong>from_document</strong>(doc)  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Create a new Schema from the Nokogiri::XML::Document <code>doc</code></p>


  </div>
</div>
<div class="tags">
  
  


</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/nokogiri/xml_schema.c', line 197</span>

static VALUE
from_document(int argc, VALUE *argv, VALUE klass)
{
  VALUE document;
  VALUE parse_options;
  int parse_options_int;
  xmlDocPtr doc;
  xmlSchemaParserCtxtPtr ctx;
  xmlSchemaPtr schema;
  VALUE errors;
  VALUE rb_schema;
  int scanned_args = 0;
  xmlExternalEntityLoader old_loader = 0;

  scanned_args = rb_scan_args(argc, argv, "11", &amp;document, &amp;parse_options);

  Data_Get_Struct(document, xmlDoc, doc);
  doc = doc-&gt;doc; /* In case someone passes us a node. ugh. */

  if (scanned_args == 1) {
    parse_options = rb_const_get_at(rb_const_get_at(mNokogiriXml, rb_intern("ParseOptions")), rb_intern("DEFAULT_SCHEMA"));
  }
  parse_options_int = (int)NUM2INT(rb_funcall(parse_options, rb_intern("to_i"), 0));

  if (has_blank_nodes_p(DOC_NODE_CACHE(doc))) {
    rb_raise(rb_eArgError, "Creating a schema from a document that has blank nodes exposed to Ruby is dangerous");
  }

  ctx = xmlSchemaNewDocParserCtxt(doc);

  errors = rb_ary_new();
  xmlSetStructuredErrorFunc((void *)errors, Nokogiri_error_array_pusher);

#ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS
  xmlSchemaSetParserStructuredErrors(
    ctx,
    Nokogiri_error_array_pusher,
    (void *)errors
  );
#endif

  if (parse_options_int &amp; XML_PARSE_NONET) {
    old_loader = xmlGetExternalEntityLoader();
    xmlSetExternalEntityLoader(xmlNoNetExternalEntityLoader);
  }

  schema = xmlSchemaParse(ctx);

  if (old_loader) {
    xmlSetExternalEntityLoader(old_loader);
  }

  xmlSetStructuredErrorFunc(NULL, NULL);
  xmlSchemaFreeParserCtxt(ctx);

  if (NULL == schema) {
    xmlErrorPtr error = xmlGetLastError();
    if (error) {
      Nokogiri_error_raise(NULL, error);
    } else {
      rb_raise(rb_eRuntimeError, "Could not parse document");
    }

    return Qnil;
  }

  rb_schema = Data_Wrap_Struct(klass, 0, dealloc, schema);
  rb_iv_set(rb_schema, "@errors", errors);
  rb_iv_set(rb_schema, "@parse_options", parse_options);

  return rb_schema;

  return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-class_method">
  
    .<strong>new</strong>(string_or_io, options = ParseOptions::DEFAULT_SCHEMA)  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Create a new Nokogiri::XML::Schema object using a <code>string_or_io</code> object.</p>


  </div>
</div>
<div class="tags">
  

</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nokogiri/xml/schema.rb', line 45</span>

<span class="kw">def</span> <span class="kw">self</span><span class="period">.</span><span class="id identifier rubyid_new">new</span> <span class="id identifier rubyid_string_or_io">string_or_io</span><span class="comma">,</span> <span class="id identifier rubyid_options">options</span> <span class="op">=</span> <span class="const"><span class="object_link"><a href="ParseOptions.html" title="Nokogiri::XML::ParseOptions (class)">ParseOptions</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="ParseOptions.html#DEFAULT_SCHEMA-constant" title="Nokogiri::XML::ParseOptions::DEFAULT_SCHEMA (constant)">DEFAULT_SCHEMA</a></span></span>
  <span class="id identifier rubyid_from_document">from_document</span><span class="lparen">(</span><span class="const"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span><span class="lparen">(</span><span class="id identifier rubyid_string_or_io">string_or_io</span><span class="rparen">)</span><span class="comma">,</span> <span class="id identifier rubyid_options">options</span><span class="rparen">)</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_memory-class_method">
  
    .<strong>read_memory</strong>(string)  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Create a new Schema from the contents of <code>string</code></p>


  </div>
</div>
<div class="tags">
  
  


</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/nokogiri/xml_schema.c', line 101</span>

static VALUE
read_memory(int argc, VALUE *argv, VALUE klass)
{
  VALUE content;
  VALUE parse_options;
  int parse_options_int;
  xmlSchemaParserCtxtPtr ctx;
  xmlSchemaPtr schema;
  VALUE errors;
  VALUE rb_schema;
  int scanned_args = 0;
  xmlExternalEntityLoader old_loader = 0;

  scanned_args = rb_scan_args(argc, argv, "11", &amp;content, &amp;parse_options);
  if (scanned_args == 1) {
    parse_options = rb_const_get_at(rb_const_get_at(mNokogiriXml, rb_intern("ParseOptions")), rb_intern("DEFAULT_SCHEMA"));
  }
  parse_options_int = (int)NUM2INT(rb_funcall(parse_options, rb_intern("to_i"), 0));

  ctx = xmlSchemaNewMemParserCtxt((const char *)StringValuePtr(content), (int)RSTRING_LEN(content));

  errors = rb_ary_new();
  xmlSetStructuredErrorFunc((void *)errors, Nokogiri_error_array_pusher);

#ifdef HAVE_XMLSCHEMASETPARSERSTRUCTUREDERRORS
  xmlSchemaSetParserStructuredErrors(
    ctx,
    Nokogiri_error_array_pusher,
    (void *)errors
  );
#endif

  if (parse_options_int &amp; XML_PARSE_NONET) {
    old_loader = xmlGetExternalEntityLoader();
    xmlSetExternalEntityLoader(xmlNoNetExternalEntityLoader);
  }

  schema = xmlSchemaParse(ctx);

  if (old_loader) {
    xmlSetExternalEntityLoader(old_loader);
  }

  xmlSetStructuredErrorFunc(NULL, NULL);
  xmlSchemaFreeParserCtxt(ctx);

  if (NULL == schema) {
    xmlErrorPtr error = xmlGetLastError();
    if (error) {
      Nokogiri_error_raise(NULL, error);
    } else {
      rb_raise(rb_eRuntimeError, "Could not parse document");
    }

    return Qnil;
  }

  rb_schema = Data_Wrap_Struct(klass, 0, dealloc, schema);
  rb_iv_set(rb_schema, "@errors", errors);
  rb_iv_set(rb_schema, "@parse_options", parse_options);

  return rb_schema;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2 id="Instance+Method+Details">Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="valid?-instance_method">
  
    #<strong>valid?</strong>(thing)  ⇒ <tt>Boolean</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Returns true if <code>thing</code> is a valid Nokogiri::XML::Document or file.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class="type">(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nokogiri/xml/schema.rb', line 67</span>

<span class="kw">def</span> <span class="id identifier rubyid_valid?">valid?</span> <span class="id identifier rubyid_thing">thing</span>
  <span class="id identifier rubyid_validate">validate</span><span class="lparen">(</span><span class="id identifier rubyid_thing">thing</span><span class="rparen">)</span><span class="period">.</span><span class="id identifier rubyid_length">length</span> <span class="op">==</span> <span class="int">0</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate-instance_method">
  
    #<strong>validate</strong>(thing)  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Validate <code>thing</code> against this schema.  <code>thing</code> can be a Nokogiri::XML::Document object, or a filename.  An Array of Nokogiri::XML::SyntaxError objects found while validating the <code>thing</code> is returned.</p>


  </div>
</div>
<div class="tags">
  

</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/nokogiri/xml/schema.rb', line 54</span>

<span class="kw">def</span> <span class="id identifier rubyid_validate">validate</span> <span class="id identifier rubyid_thing">thing</span>
  <span class="kw">if</span> <span class="id identifier rubyid_thing">thing</span><span class="period">.</span><span class="id identifier rubyid_is_a?">is_a?</span><span class="lparen">(</span><span class="const"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="Document.html" title="Nokogiri::XML::Document (class)">Document</a></span></span><span class="rparen">)</span> 
    <span class="id identifier rubyid_validate_document">validate_document</span><span class="lparen">(</span><span class="id identifier rubyid_thing">thing</span><span class="rparen">)</span> 
  <span class="kw">elsif</span> <span class="const">File</span><span class="period">.</span><span class="id identifier rubyid_file?">file?</span><span class="lparen">(</span><span class="id identifier rubyid_thing">thing</span><span class="rparen">)</span>
    <span class="id identifier rubyid_validate_file">validate_file</span><span class="lparen">(</span><span class="id identifier rubyid_thing">thing</span><span class="rparen">)</span>
  <span class="kw">else</span>
    <span class="id identifier rubyid_raise">raise</span> <span class="const">ArgumentError</span><span class="comma">,</span> <span class="tstring"><span class="tstring_beg">"</span><span class="tstring_content">Must provide Nokogiri::Xml::Document or the name of an existing file</span><span class="tstring_end">"</span></span>
  <span class="kw">end</span>
<span class="kw">end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Sep 27 15:13:34 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-3.0.2).
</div>

    </div>
  </body>
</html>
