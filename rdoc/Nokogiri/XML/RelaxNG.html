<!DOCTYPE html>
<html>
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Nokogiri::XML::RelaxNG
  
    — Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css">

  <link rel="stylesheet" href="../../css/common.css" type="text/css">

<script type="text/javascript">
  pathId = "Nokogiri::XML::RelaxNG";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


      <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1260604-8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-1260604-8');
    </script>
</head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> »
    <span class="title"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span> » <span class="title"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span>
     » 
    <span class="title">RelaxNG</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link" href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content">
<h1 id="Class%3A+Nokogiri%3A%3AXML%3A%3ARelaxNG">Class: Nokogiri::XML::RelaxNG
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class="object_link"><a href="Schema.html" title="Nokogiri::XML::Schema (class)">Schema</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class="object_link"><a href="Schema.html" title="Nokogiri::XML::Schema (class)">Schema</a></span></li>
          
            <li class="next">Nokogiri::XML::RelaxNG</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/nokogiri/xml/relax_ng.rb<span class="defines">,<br>
  ext/nokogiri/xml_relax_ng.c</span>
</dd>
  </dl>
  
</div>

<h2 id="Overview">Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>Nokogiri::XML::RelaxNG is used for validating XML against a RelaxNG schema.</p>

<h2 id="label-Synopsis">Synopsis</h2>

<p>Validate an XML document against a RelaxNG schema.  Loop over the errors that are returned and print them out:</p>

<pre class="code ruby"><code class="ruby"><span class="id identifier rubyid_schema">schema</span>  <span class="op">=</span> <span class="const"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span><span class="op">::</span><span class="const">RelaxNG</span><span class="lparen">(</span><span class="const">File</span><span class="period">.</span><span class="id identifier rubyid_open">open</span><span class="lparen">(</span><span class="const">ADDRESS_SCHEMA_FILE</span><span class="rparen">)</span><span class="rparen">)</span>
<span class="id identifier rubyid_doc">doc</span>     <span class="op">=</span> <span class="const"><span class="object_link"><a href="../../Nokogiri.html" title="Nokogiri (module)">Nokogiri</a></span></span><span class="op">::</span><span class="const"><span class="object_link"><a href="../XML.html" title="Nokogiri::XML (module)">XML</a></span></span><span class="lparen">(</span><span class="const">File</span><span class="period">.</span><span class="id identifier rubyid_open">open</span><span class="lparen">(</span><span class="const">ADDRESS_XML_FILE</span><span class="rparen">)</span><span class="rparen">)</span>

<span class="id identifier rubyid_schema">schema</span><span class="period">.</span><span class="id identifier rubyid_validate">validate</span><span class="lparen">(</span><span class="id identifier rubyid_doc">doc</span><span class="rparen">)</span><span class="period">.</span><span class="id identifier rubyid_each">each</span> <span class="kw">do</span> <span class="op">|</span><span class="id identifier rubyid_error">error</span><span class="op">|</span>
  <span class="id identifier rubyid_puts">puts</span> <span class="id identifier rubyid_error">error</span><span class="period">.</span><span class="id identifier rubyid_message">message</span>
<span class="kw">end</span>
</code></pre>

<p>The list of errors are Nokogiri::XML::SyntaxError objects.</p>

<p>NOTE: RelaxNG input is always treated as TRUSTED documents, meaning that they will cause the underlying parsing libraries to access network resources. This is counter to Nokogiri's “untrusted by default” security policy, but is a limitation of the underlying libraries.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2 id="Class+Method+Summary">
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#from_document-class_method" title="from_document (class method)">.<strong>from_document</strong>(doc)  ⇒ Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Create a new RelaxNG schema from the Nokogiri::XML::Document <code>doc</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_memory-class_method" title="read_memory (class method)">.<strong>read_memory</strong>(string)  ⇒ Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class="inline">
<p>Create a new RelaxNG from the contents of <code>string</code>.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  

  <div id="class_method_details" class="method_details_list">
    <h2 id="Class+Method+Details">Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="from_document-class_method">
  
    .<strong>from_document</strong>(doc)  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Create a new RelaxNG schema from the Nokogiri::XML::Document <code>doc</code></p>


  </div>
</div>
<div class="tags">
  
  


</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/nokogiri/xml_relax_ng.c', line 118</span>

static VALUE
from_document(int argc, VALUE *argv, VALUE klass)
{
  VALUE document;
  VALUE parse_options;
  xmlDocPtr doc;
  xmlRelaxNGParserCtxtPtr ctx;
  xmlRelaxNGPtr schema;
  VALUE errors;
  VALUE rb_schema;
  int scanned_args = 0;

  scanned_args = rb_scan_args(argc, argv, "11", &amp;document, &amp;parse_options);

  Data_Get_Struct(document, xmlDoc, doc);
  doc = doc-&gt;doc; /* In case someone passes us a node. ugh. */

  if (scanned_args == 1) {
    parse_options = rb_const_get_at(rb_const_get_at(mNokogiriXml, rb_intern("ParseOptions")), rb_intern("DEFAULT_SCHEMA"));
  }

  ctx = xmlRelaxNGNewDocParserCtxt(doc);

  errors = rb_ary_new();
  xmlSetStructuredErrorFunc((void *)errors, Nokogiri_error_array_pusher);

#ifdef HAVE_XMLRELAXNGSETPARSERSTRUCTUREDERRORS
  xmlRelaxNGSetParserStructuredErrors(
    ctx,
    Nokogiri_error_array_pusher,
    (void *)errors
  );
#endif

  schema = xmlRelaxNGParse(ctx);

  xmlSetStructuredErrorFunc(NULL, NULL);
  xmlRelaxNGFreeParserCtxt(ctx);

  if (NULL == schema) {
    xmlErrorPtr error = xmlGetLastError();
    if (error) {
      Nokogiri_error_raise(NULL, error);
    } else {
      rb_raise(rb_eRuntimeError, "Could not parse document");
    }

    return Qnil;
  }

  rb_schema = Data_Wrap_Struct(klass, 0, dealloc, schema);
  rb_iv_set(rb_schema, "@errors", errors);
  rb_iv_set(rb_schema, "@parse_options", parse_options);

  return rb_schema;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read_memory-class_method">
  
    .<strong>read_memory</strong>(string)  ⇒ <tt>Object</tt> 
  

  

  
</h3>
<div class="docstring">
  <div class="discussion">
    
<p>Create a new RelaxNG from the contents of <code>string</code></p>


  </div>
</div>
<div class="tags">
  
  


</div>
<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/nokogiri/xml_relax_ng.c', line 60</span>

static VALUE
read_memory(int argc, VALUE *argv, VALUE klass)
{
  VALUE content;
  VALUE parse_options;
  xmlRelaxNGParserCtxtPtr ctx;
  xmlRelaxNGPtr schema;
  VALUE errors;
  VALUE rb_schema;
  int scanned_args = 0;

  scanned_args = rb_scan_args(argc, argv, "11", &amp;content, &amp;parse_options);
  if (scanned_args == 1) {
    parse_options = rb_const_get_at(rb_const_get_at(mNokogiriXml, rb_intern("ParseOptions")), rb_intern("DEFAULT_SCHEMA"));
  }

  ctx = xmlRelaxNGNewMemParserCtxt((const char *)StringValuePtr(content), (int)RSTRING_LEN(content));

  errors = rb_ary_new();
  xmlSetStructuredErrorFunc((void *)errors, Nokogiri_error_array_pusher);

#ifdef HAVE_XMLRELAXNGSETPARSERSTRUCTUREDERRORS
  xmlRelaxNGSetParserStructuredErrors(
    ctx,
    Nokogiri_error_array_pusher,
    (void *)errors
  );
#endif

  schema = xmlRelaxNGParse(ctx);

  xmlSetStructuredErrorFunc(NULL, NULL);
  xmlRelaxNGFreeParserCtxt(ctx);

  if (NULL == schema) {
    xmlErrorPtr error = xmlGetLastError();
    if (error) {
      Nokogiri_error_raise(NULL, error);
    } else {
      rb_raise(rb_eRuntimeError, "Could not parse document");
    }

    return Qnil;
  }

  rb_schema = Data_Wrap_Struct(klass, 0, dealloc, schema);
  rb_iv_set(rb_schema, "@errors", errors);
  rb_iv_set(rb_schema, "@parse_options", parse_options);

  return rb_schema;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Oct 26 16:01:35 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-3.0.2).
</div>

    </div>
  </body>
</html>
